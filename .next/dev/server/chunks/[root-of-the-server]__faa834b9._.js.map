{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/app/api/notifications/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport mysql from \"mysql2/promise\"\n\n// ローカル環境で環境変数を設定してください\nconst getConnection = async () => {\n  return await mysql.createConnection({\n    host: process.env.DB_HOST || \"34.67.209.187\",\n    port: Number.parseInt(process.env.DB_PORT || \"3306\"),\n    user: process.env.DB_USER || \"your_username\",\n    password: process.env.DB_PASSWORD || \"your_password\",\n    database: process.env.DB_NAME || \"your_database\",\n    ssl: {\n      rejectUnauthorized: false,\n    },\n  })\n}\n\n// お知らせ一覧を取得\nexport async function GET() {\n  let connection\n  try {\n    connection = await getConnection()\n\n    const [rows] = await connection.execute(\n      \"SELECT id, title, message, image_url, created_at, is_read FROM notifications ORDER BY created_at DESC LIMIT 50\",\n    )\n\n    return NextResponse.json(rows)\n  } catch (error) {\n    console.error(\"[v0] Notifications fetch error:\", error)\n    return NextResponse.json({ error: \"Failed to fetch notifications\" }, { status: 500 })\n  } finally {\n    if (connection) {\n      await connection.end()\n    }\n  }\n}\n\n// 新しいお知らせを投稿\nexport async function POST(request: Request) {\n  let connection\n  try {\n    const { title, message, image_url } = await request.json()\n\n    if (!title || !message) {\n      return NextResponse.json({ error: \"Title and message are required\" }, { status: 400 })\n    }\n\n    connection = await getConnection()\n\n    const jstNow = new Date().toLocaleString(\"sv-SE\", { timeZone: \"Asia/Tokyo\" }).replace(\"T\", \" \")\n\n    await connection.execute(\n      \"INSERT INTO notifications (title, message, image_url, created_at, is_read) VALUES (?, ?, ?, ?, false)\",\n      [title, message, image_url || null, jstNow],\n    )\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"[v0] Notification create error:\", error)\n    return NextResponse.json({ error: \"Failed to create notification\" }, { status: 500 })\n  } finally {\n    if (connection) {\n      await connection.end()\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,uBAAuB;AACvB,MAAM,gBAAgB;IACpB,OAAO,MAAM,wJAAK,CAAC,gBAAgB,CAAC;QAClC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7B,MAAM,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7C,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;QACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;QACjC,KAAK;YACH,oBAAoB;QACtB;IACF;AACF;AAGO,eAAe;IACpB,IAAI;IACJ,IAAI;QACF,aAAa,MAAM;QAEnB,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CACrC;QAGF,OAAO,0JAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF,SAAU;QACR,IAAI,YAAY;YACd,MAAM,WAAW,GAAG;QACtB;IACF;AACF;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;IACJ,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,IAAI,CAAC,SAAS,CAAC,SAAS;YACtB,OAAO,0JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,aAAa,MAAM;QAEnB,MAAM,SAAS,IAAI,OAAO,cAAc,CAAC,SAAS;YAAE,UAAU;QAAa,GAAG,OAAO,CAAC,KAAK;QAE3F,MAAM,WAAW,OAAO,CACtB,yGACA;YAAC;YAAO;YAAS,aAAa;YAAM;SAAO;QAG7C,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgC,GAAG;YAAE,QAAQ;QAAI;IACrF,SAAU;QACR,IAAI,YAAY;YACd,MAAM,WAAW,GAAG;QACtB;IACF;AACF"}}]
}
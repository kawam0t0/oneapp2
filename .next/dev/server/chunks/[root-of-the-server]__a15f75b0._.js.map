{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport mysql from \"mysql2/promise\"\nimport { cookies } from \"next/headers\"\n\nconst getConnection = async () => {\n  return await mysql.createConnection({\n    host: process.env.DB_HOST || \"34.67.209.187\",\n    port: Number.parseInt(process.env.DB_PORT || \"3306\"),\n    user: process.env.DB_USER,\n    password: process.env.DB_PASSWORD,\n    database: process.env.DB_NAME,\n    ssl: { rejectUnauthorized: false },\n  })\n}\n\nexport async function POST(request: Request) {\n  let connection\n  try {\n    const { store_id, email, password } = await request.json()\n\n    if (!store_id || !email || !password) {\n      return NextResponse.json({ error: \"店舗、メールアドレス、パスワードを入力してください\" }, { status: 400 })\n    }\n\n    connection = await getConnection()\n\n    // 店舗ID、メールアドレス、パスワードの組み合わせを確認\n    const [rows] = (await connection.execute(\n      \"SELECT id, store_name, mail FROM stores WHERE id = ? AND mail = ? AND password = ?\",\n      [store_id, email, password],\n    )) as [any[], any]\n\n    if (rows.length === 0) {\n      return NextResponse.json({ error: \"店舗、メールアドレス、またはパスワードが正しくありません\" }, { status: 401 })\n    }\n\n    const store = rows[0]\n\n    // セッションをクッキーに保存\n    const cookieStore = await cookies()\n    cookieStore.set(\n      \"session\",\n      JSON.stringify({\n        store_id: store.id,\n        store_name: store.store_name,\n        email: store.mail,\n        logged_in_at: new Date().toISOString(),\n      }),\n      {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === \"production\",\n        sameSite: \"lax\",\n        maxAge: 60 * 60 * 24 * 7, // 7日間\n        path: \"/\",\n      },\n    )\n\n    return NextResponse.json({\n      success: true,\n      store_name: store.store_name,\n    })\n  } catch (error) {\n    console.error(\"[v0] Login error:\", error)\n    return NextResponse.json({ error: \"ログイン処理中にエラーが発生しました\" }, { status: 500 })\n  } finally {\n    if (connection) await connection.end()\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,gBAAgB;IACpB,OAAO,MAAM,wJAAK,CAAC,gBAAgB,CAAC;QAClC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7B,MAAM,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7C,MAAM,QAAQ,GAAG,CAAC,OAAO;QACzB,UAAU,QAAQ,GAAG,CAAC,WAAW;QACjC,UAAU,QAAQ,GAAG,CAAC,OAAO;QAC7B,KAAK;YAAE,oBAAoB;QAAM;IACnC;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;IACJ,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,UAAU;YACpC,OAAO,0JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;QAEA,aAAa,MAAM;QAEnB,8BAA8B;QAC9B,MAAM,CAAC,KAAK,GAAI,MAAM,WAAW,OAAO,CACtC,sFACA;YAAC;YAAU;YAAO;SAAS;QAG7B,IAAI,KAAK,MAAM,KAAK,GAAG;YACrB,OAAO,0JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,QAAQ,IAAI,CAAC,EAAE;QAErB,gBAAgB;QAChB,MAAM,cAAc,MAAM,IAAA,sJAAO;QACjC,YAAY,GAAG,CACb,WACA,KAAK,SAAS,CAAC;YACb,UAAU,MAAM,EAAE;YAClB,YAAY,MAAM,UAAU;YAC5B,OAAO,MAAM,IAAI;YACjB,cAAc,IAAI,OAAO,WAAW;QACtC,IACA;YACE,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;QACR;QAGF,OAAO,0JAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,YAAY,MAAM,UAAU;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;IAC1E,SAAU;QACR,IAAI,YAAY,MAAM,WAAW,GAAG;IACtC;AACF"}}]
}
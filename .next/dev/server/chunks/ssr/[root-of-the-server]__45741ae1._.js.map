{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/components/dashboard-view.tsx"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport mysql from \"mysql2/promise\"\n\n// MySQL接続設定\nconst getConnection = async () => {\n  return await mysql.createConnection({\n    host: process.env.DB_HOST || \"34.67.209.187\",\n    port: Number.parseInt(process.env.DB_PORT || \"3306\"),\n    user: process.env.DB_USER || \"your_username\",\n    password: process.env.DB_PASSWORD || \"your_password\",\n    database: process.env.DB_NAME || \"your_database_name\",\n    ssl: {\n      rejectUnauthorized: false,\n    },\n  })\n}\n\nconst categorizeItem = (details: string): string | null => {\n  if (!details) return \"その他\"\n  if (details.includes(\"高崎棟高店バキューム\")) return null\n  if (details.includes(\"サブスク\")) return \"サブスク\"\n  if (details.includes(\"リピ\")) return \"リピート\"\n  if (details.includes(\"新規\")) return \"新規\"\n  if (details.includes(\"⇒\")) return \"コースアップ\"\n  if (details.includes(\"ポイント\")) return \"ポイント\"\n  if (details.includes(\"キャンペーン\")) return \"キャンペーン\"\n  if (details.includes(\"無料券\")) return \"無料券\"\n  return details\n}\n\nconst aggregateData = (rows: any[]) => {\n  const storeMap = new Map<string, { items: { [key: string]: number }; total: number }>()\n\n  rows.forEach((row) => {\n    const store = row.store\n    const item = categorizeItem(row.details)\n    const count = row.count\n\n    if (!store || store === \"0\" || store.toString().trim() === \"\") {\n      return\n    }\n\n    if (item === null) {\n      return\n    }\n\n    if (!storeMap.has(store)) {\n      storeMap.set(store, { items: {}, total: 0 })\n    }\n\n    const storeData = storeMap.get(store)!\n    storeData.items[item] = (storeData.items[item] || 0) + count\n    storeData.total += count\n  })\n\n  return Array.from(storeMap.entries()).map(([store, data]) => ({\n    store,\n    items: data.items,\n    total: data.total,\n  }))\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url)\n    const period = searchParams.get(\"period\") || \"2025-11\"\n\n    const [year, month] = period.split(\"-\")\n\n    // 指定された年月の開始日と終了日を計算\n    const startDate = `${year}-${month}-01`\n    const endDate = new Date(Number.parseInt(year), Number.parseInt(month), 0).getDate()\n    const endDateStr = `${year}-${month}-${endDate}`\n\n    const today = new Date()\n    const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, \"0\")}-${String(today.getDate()).padStart(2, \"0\")}`\n\n    console.log(\"[v0] Fetching data for period:\", period)\n    console.log(\"[v0] Date range:\", startDate, \"to\", endDateStr)\n    console.log(\"[v0] Today:\", todayStr)\n\n    const connection = await getConnection()\n\n    const [monthlyRows] = await connection.execute(\n      `SELECT store, details, COUNT(*) as count \n       FROM onetime \n       WHERE date >= ? AND date <= ?\n       AND (card_entry_method IS NULL OR card_entry_method != 'KEYED')\n       GROUP BY store, details\n       ORDER BY store, details`,\n      [startDate, endDateStr],\n    )\n\n    const [todayRows] = await connection.execute(\n      `SELECT store, details, COUNT(*) as count \n       FROM onetime \n       WHERE date = ?\n       AND (card_entry_method IS NULL OR card_entry_method != 'KEYED')\n       GROUP BY store, details\n       ORDER BY store, details`,\n      [todayStr],\n    )\n\n    await connection.end()\n\n    const monthlyData = aggregateData(monthlyRows as any[])\n    const todayData = aggregateData(todayRows as any[])\n\n    console.log(\"[v0] Found\", monthlyData.length, \"stores for monthly data\")\n    console.log(\"[v0] Found\", todayData.length, \"stores for today data\")\n\n    return NextResponse.json({\n      monthly: monthlyData,\n      today: todayData,\n    })\n  } catch (error) {\n    console.error(\"[v0] Database error:\", error)\n    return NextResponse.json({ error: \"データベース接続エラー\", details: String(error) }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/app/page.tsx"],"sourcesContent":["import DashboardView from \"@/components/dashboard-view\"\n\nexport default function Page() {\n  return <DashboardView />\n}\n"],"names":[],"mappings":";;;;;AAAA;;;AAEe,SAAS;IACtB,qBAAO,wPAAC,qJAAa;;;;;AACvB"}}]
}
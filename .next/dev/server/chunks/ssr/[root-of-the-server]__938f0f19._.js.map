{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/components/auth-provider.tsx"],"sourcesContent":["\"use client\"\n\nimport type React from \"react\"\n\nimport { createContext, useContext, useEffect, useState } from \"react\"\nimport { useRouter, usePathname } from \"next/navigation\"\n\ninterface Session {\n  store_id: number\n  store_name: string\n  email: string\n  logged_in_at: string\n}\n\ninterface AuthContextType {\n  session: Session | null\n  isLoading: boolean\n  logout: () => Promise<void>\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  session: null,\n  isLoading: true,\n  logout: async () => {},\n})\n\nexport function useAuth() {\n  return useContext(AuthContext)\n}\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n  const [session, setSession] = useState<Session | null>(null)\n  const [isLoading, setIsLoading] = useState(true)\n  const router = useRouter()\n  const pathname = usePathname()\n\n  useEffect(() => {\n    const checkSession = async () => {\n      try {\n        const res = await fetch(\"/api/auth/session\")\n        if (res.ok) {\n          const data = await res.json()\n          if (data.authenticated) {\n            setSession(data)\n          } else {\n            setSession(null)\n            if (pathname !== \"/login\") {\n              router.push(\"/login\")\n            }\n          }\n        } else {\n          setSession(null)\n          if (pathname !== \"/login\") {\n            router.push(\"/login\")\n          }\n        }\n      } catch (error) {\n        console.error(\"Session check failed:\", error)\n        setSession(null)\n        if (pathname !== \"/login\") {\n          router.push(\"/login\")\n        }\n      } finally {\n        setIsLoading(false)\n      }\n    }\n\n    checkSession()\n  }, [pathname, router])\n\n  const logout = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { method: \"POST\" })\n      setSession(null)\n      router.push(\"/login\")\n    } catch (error) {\n      console.error(\"Logout failed:\", error)\n    }\n  }\n\n  // ログインページは認証チェックをスキップ\n  if (pathname === \"/login\") {\n    return <AuthContext.Provider value={{ session, isLoading: false, logout }}>{children}</AuthContext.Provider>\n  }\n\n  // ローディング中\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-yellow-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-12 h-12 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-gray-600\">読み込み中...</p>\n        </div>\n      </div>\n    )\n  }\n\n  // 未認証の場合は何も表示しない（リダイレクト中）\n  if (!session) {\n    return null\n  }\n\n  return <AuthContext.Provider value={{ session, isLoading, logout }}>{children}</AuthContext.Provider>\n}\n"],"names":[],"mappings":";;;;;;;AAIA;AACA;AALA;;;;AAoBA,MAAM,4BAAc,IAAA,gOAAa,EAAkB;IACjD,SAAS;IACT,WAAW;IACX,QAAQ,WAAa;AACvB;AAEO,SAAS;IACd,OAAO,IAAA,6NAAU,EAAC;AACpB;AAEO,SAAS,aAAa,EAAE,QAAQ,EAAiC;IACtE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2NAAQ,EAAiB;IACvD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,2NAAQ,EAAC;IAC3C,MAAM,SAAS,IAAA,yJAAS;IACxB,MAAM,WAAW,IAAA,2JAAW;IAE5B,IAAA,4NAAS,EAAC;QACR,MAAM,eAAe;YACnB,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM;gBACxB,IAAI,IAAI,EAAE,EAAE;oBACV,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,IAAI,KAAK,aAAa,EAAE;wBACtB,WAAW;oBACb,OAAO;wBACL,WAAW;wBACX,IAAI,aAAa,UAAU;4BACzB,OAAO,IAAI,CAAC;wBACd;oBACF;gBACF,OAAO;oBACL,WAAW;oBACX,IAAI,aAAa,UAAU;wBACzB,OAAO,IAAI,CAAC;oBACd;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yBAAyB;gBACvC,WAAW;gBACX,IAAI,aAAa,UAAU;oBACzB,OAAO,IAAI,CAAC;gBACd;YACF,SAAU;gBACR,aAAa;YACf;QACF;QAEA;IACF,GAAG;QAAC;QAAU;KAAO;IAErB,MAAM,SAAS;QACb,IAAI;YACF,MAAM,MAAM,oBAAoB;gBAAE,QAAQ;YAAO;YACjD,WAAW;YACX,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;QAClC;IACF;IAEA,sBAAsB;IACtB,IAAI,aAAa,UAAU;QACzB,qBAAO,wPAAC,YAAY,QAAQ;YAAC,OAAO;gBAAE;gBAAS,WAAW;gBAAO;YAAO;sBAAI;;;;;;IAC9E;IAEA,UAAU;IACV,IAAI,WAAW;QACb,qBACE,wPAAC;YAAI,WAAU;sBACb,cAAA,wPAAC;gBAAI,WAAU;;kCACb,wPAAC;wBAAI,WAAU;;;;;;kCACf,wPAAC;wBAAE,WAAU;kCAAgB;;;;;;;;;;;;;;;;;IAIrC;IAEA,0BAA0B;IAC1B,IAAI,CAAC,SAAS;QACZ,OAAO;IACT;IAEA,qBAAO,wPAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAS;YAAW;QAAO;kBAAI;;;;;;AACvE"}}]
}
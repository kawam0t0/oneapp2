{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///Users/kawamotoshuntasuku/Desktop/dev/oneapp/app/api/calendar/route.ts"],"sourcesContent":["import mysql from \"mysql2/promise\"\nimport { NextResponse } from \"next/server\"\n\nconst getConnection = async () => {\n  return await mysql.createConnection({\n    host: process.env.DB_HOST || \"34.67.209.187\",\n    port: Number.parseInt(process.env.DB_PORT || \"3306\"),\n    user: process.env.DB_USER || \"your_username\",\n    password: process.env.DB_PASSWORD || \"your_password\",\n    database: process.env.DB_NAME || \"your_database\",\n    ssl: {\n      rejectUnauthorized: false,\n    },\n  })\n}\n\n// イベント取得\nexport async function GET(request: Request) {\n  let connection\n  try {\n    const { searchParams } = new URL(request.url)\n    const year = searchParams.get(\"year\") || new Date().getFullYear()\n    const month = searchParams.get(\"month\") || new Date().getMonth() + 1\n\n    // 月の最初と最後の日を計算\n    const startDate = `${year}-${String(month).padStart(2, \"0\")}-01`\n    const endDate = `${year}-${String(month).padStart(2, \"0\")}-31`\n\n    connection = await getConnection()\n    const [rows] = await connection.execute(\n      \"SELECT id, title, DATE_FORMAT(date, '%Y-%m-%d') as date, color FROM calendar_events WHERE date BETWEEN ? AND ? ORDER BY date ASC\",\n      [startDate, endDate],\n    )\n\n    console.log(\"[v0] Fetched events from DB:\", rows)\n    return NextResponse.json(rows)\n  } catch (error) {\n    console.error(\"[v0] Calendar fetch error:\", error)\n    return NextResponse.json({ error: \"Failed to fetch events\" }, { status: 500 })\n  } finally {\n    if (connection) await connection.end()\n  }\n}\n\n// イベント追加\nexport async function POST(request: Request) {\n  let connection\n  try {\n    const { title, date, color } = await request.json()\n    console.log(\"[v0] Adding event:\", { title, date, color })\n\n    if (!title || !date) {\n      return NextResponse.json({ error: \"Title and date are required\" }, { status: 400 })\n    }\n\n    connection = await getConnection()\n    const [result] = await connection.execute(\"INSERT INTO calendar_events (title, date, color) VALUES (?, ?, ?)\", [\n      title,\n      date,\n      color || \"#3b82f6\",\n    ])\n\n    console.log(\"[v0] Event added successfully:\", result)\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error(\"[v0] Calendar add error:\", error)\n    return NextResponse.json({ error: \"Failed to add event\" }, { status: 500 })\n  } finally {\n    if (connection) await connection.end()\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,gBAAgB;IACpB,OAAO,MAAM,wJAAK,CAAC,gBAAgB,CAAC;QAClC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7B,MAAM,OAAO,QAAQ,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7C,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;QAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;QACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;QACjC,KAAK;YACH,oBAAoB;QACtB;IACF;AACF;AAGO,eAAe,IAAI,OAAgB;IACxC,IAAI;IACJ,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW,IAAI,OAAO,WAAW;QAC/D,MAAM,QAAQ,aAAa,GAAG,CAAC,YAAY,IAAI,OAAO,QAAQ,KAAK;QAEnE,eAAe;QACf,MAAM,YAAY,GAAG,KAAK,CAAC,EAAE,OAAO,OAAO,QAAQ,CAAC,GAAG,KAAK,GAAG,CAAC;QAChE,MAAM,UAAU,GAAG,KAAK,CAAC,EAAE,OAAO,OAAO,QAAQ,CAAC,GAAG,KAAK,GAAG,CAAC;QAE9D,aAAa,MAAM;QACnB,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CACrC,oIACA;YAAC;YAAW;SAAQ;QAGtB,QAAQ,GAAG,CAAC,gCAAgC;QAC5C,OAAO,0JAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAC9E,SAAU;QACR,IAAI,YAAY,MAAM,WAAW,GAAG;IACtC;AACF;AAGO,eAAe,KAAK,OAAgB;IACzC,IAAI;IACJ,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,IAAI;QACjD,QAAQ,GAAG,CAAC,sBAAsB;YAAE;YAAO;YAAM;QAAM;QAEvD,IAAI,CAAC,SAAS,CAAC,MAAM;YACnB,OAAO,0JAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA8B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,aAAa,MAAM;QACnB,MAAM,CAAC,OAAO,GAAG,MAAM,WAAW,OAAO,CAAC,qEAAqE;YAC7G;YACA;YACA,SAAS;SACV;QAED,QAAQ,GAAG,CAAC,kCAAkC;QAC9C,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,0JAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E,SAAU;QACR,IAAI,YAAY,MAAM,WAAW,GAAG;IACtC;AACF"}}]
}